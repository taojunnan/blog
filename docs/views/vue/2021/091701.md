---
title: é«˜å¾·åœ°å›¾å¤©æ°”æ¥å£è¿”å›å¤©æ°”ç±»å‹å›¾æ ‡url
date: 2021-09-17
author: Junan
sidebar: 'auto'
categories:
 - Vue
tags:
 - Vue
publish: true
isShowComments: true
---

## å¤©æ°”ç±»å‹åˆ†ç±»

ç”±äºé«˜å¾·åœ°å›¾[æ‰€æœ‰å¤©æ°”ç°è±¡è¡¨](https://lbs.amap.com/api/webservice/guide/tools/weather-code)åˆ†ç±»å¾ˆå¤šï¼Œä¸å¯èƒ½ä¸€ä¸ªå¤©æ°”ä¸€ä¸ªå›¾æ ‡ï¼Œæ‰€ä»¥å°†å¸¸è§çš„å¤©æ°”åˆ†ç±»å¦‚ä¸‹  

![åˆ†ç±»å›¾ç‰‡](https://gitee.com/taojunnan/blog-resources/raw/master/static/202109161634466.png)  

è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦åˆ†ç±»

## ä»£ç å®ç°

```js
/**
 * weather.js
 * é«˜å¾·åœ°å›¾å¤©æ°”å°è£…ï¼Œå¯ä»¥è¿”å›å¸¦å›¾æ ‡urlçš„å¤©æ°”å¯¹è±¡ğŸ‘
 * æ‚¨å¯èƒ½éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š
 * 1, åœ°å›¾KEY, VERSION
 * 2, å˜é‡ iconWeatherMap
 * 3, function getIcon ä¸­çš„urlè·¯å¾„
 * @author tjn
 * @date 2021-09-10
 * @see https://pan.baidu.com/s/14Qo0uS7a9Oz5ZhHgw6TpyA æå–ç : 4qjh  æ‰€æœ‰å›¾æ ‡
 */

// å®‰è£…ï¼šnpm i @amap/amap-jsapi-loader --save
import AMapLoader from '@amap/amap-jsapi-loader'

// åœ°å›¾keyå’Œç‰ˆæœ¬
const KEY = 'your amap key'
const VERSION = '2.0'

// é«˜å¾·åœ°å›¾å¯¹è±¡
let AMap = null
// å¤©æ°”å®ä¾‹å¯¹è±¡
let weather = null

/**
 * å›¾æ ‡å’Œå¤©æ°”ç°è±¡çš„æ˜ å°„å…³ç³»
 * key: æŸä¸€ç±»å¤©æ°”ç°è±¡ï¼Œè¿™ä¸ªkeyä¼šå’Œiconåä¸€ä¸€å¯¹åº”
 * value: æŸä¸€ç±»ä¸‹å¤©æ°”ç°è±¡ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚åˆ’åˆ†åˆ†ç±»
 * @see https://lbs.amap.com/api/webservice/guide/tools/weather-code
 */
const iconWeatherMap = {
  'é£': ['æœ‰é£', 'å¹³é™', 'å¾®é£', 'å’Œé£', 'æ¸…é£', 'å¼ºé£/åŠ²é£', 'ç–¾é£', 'å¤§é£', 'çƒˆé£', 'é£æš´', 'ç‹‚çˆ†é£', 'é£“é£', 'çƒ­å¸¦é£æš´', 'é¾™å·é£'],
  'å¤šäº‘': ['å°‘äº‘', 'æ™´é—´å¤šäº‘', 'å¤šäº‘'],
  'é›ª': ['é›ª', 'é˜µé›ª', 'å°é›ª', 'ä¸­é›ª', 'å¤§é›ª', 'æš´é›ª', 'å°é›ª-ä¸­é›ª', 'ä¸­é›ª-å¤§é›ª', 'å¤§é›ª-æš´é›ª', 'å†·'],
  'é›¾': ['æµ®å°˜', 'æ‰¬æ²™', 'æ²™å°˜æš´', 'å¼ºæ²™å°˜æš´', 'é›¾', 'æµ“é›¾', 'å¼ºæµ“é›¾', 'è½»é›¾', 'å¤§é›¾', 'ç‰¹å¼ºæµ“é›¾'],
  'æ™´': ['æ™´', 'çƒ­'],
  'é›¨å¤¹é›ª': ['é›¨é›ªå¤©æ°”', 'é›¨å¤¹é›ª', 'é˜µé›¨å¤¹é›ª'],
  'é›¨': ['é˜µé›¨', 'é›·é˜µé›¨', 'é›·é˜µé›¨å¹¶ä¼´æœ‰å†°é›¹', 'å°é›¨', 'ä¸­é›¨', 'å¤§é›¨', 'æš´é›¨', 'å¤§æš´é›¨', 'ç‰¹å¤§æš´é›¨', 'å¼ºé˜µé›¨', 'å¼ºé›·é˜µé›¨', 'æç«¯é™é›¨', 'æ¯›æ¯›é›¨/ç»†é›¨', 'é›¨', 'å°é›¨-ä¸­é›¨', 'ä¸­é›¨-å¤§é›¨', 'å¤§é›¨-æš´é›¨', 'æš´é›¨-å¤§æš´é›¨', 'å¤§æš´é›¨-ç‰¹å¤§æš´é›¨', 'å†»é›¨'],
  'é˜´': ['é˜´', 'éœ¾', 'ä¸­åº¦éœ¾', 'é‡åº¦éœ¾', 'ä¸¥é‡éœ¾', 'æœªçŸ¥']
}

/**
 * åŠ è½½åœ°å›¾å¹¶å¼•å…¥å¤©æ°”ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡åŠ è½½åœ°å›¾ï¼Œéœ€è¦Keyï¼Œversion
 * å¦‚æœåœ¨åé¢çš„ä¸šåŠ¡ä¸­ï¼Œè¿™é‡Œä¸æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½åœ°å›¾ï¼Œkeyå’Œversionå¯ä»¥çœç•¥
 * @see https://lbs.amap.com/api/jsapi-v2/guide/abc/load
 */
function _initWeather () {
  console.debug('---init weather---')

  return AMapLoader.load({
    key: KEY,
    version: VERSION,
    plugins: ['AMap.Weather']
  }).then((Map) => {
    // ä¿å­˜åœ°å›¾å¯¹è±¡
    AMap = Map
  }).catch(e => {
    console.error('åˆå§‹åŒ–åœ°å›¾/å¤©æ°”å¤±è´¥ = ', e)
  })
}

/**
 * æ ¹æ®å¤©æ°”ç°è±¡è¿”å›å…¶å›¾æ ‡icon url
 * @param {String} weather å¤©æ°”ç°è±¡
 * @returns å¤©æ°”ç°è±¡å¯¹åº”çš„æŸä¸€ç±»çš„url
 */
function _getIcon (weather) {
  // è¿™ä¸ªæ˜¯iconçš„é»˜è®¤å€¼
  let url = require('@/assets/images/icon/weather/é˜´.png')

  for (const weatherKey in iconWeatherMap) {
    if (Object.hasOwnProperty.call(iconWeatherMap, weatherKey)) {
      const weatherNames = iconWeatherMap[weatherKey]
      const findWeatherItem = weatherNames.find(name => weather === name)

      // å¦‚æœæ‰¾äº†æŸä¸€ç±»çš„å›¾æ ‡äº†ï¼Œé‚£é‡æ–°å¤åˆ¶url
      if (findWeatherItem) {
        // è¿™é‡Œçš„weatherKeyå’Œiconçš„åå­—ä¸€ä¸€å¯¹åº”äº†
        url = require(`@/assets/images/icon/weather/${weatherKey}.png`)
        // console.debug('@find weather key = ', weatherKey)
        break
      }
    }
  }

  return url
}

/**
 * æŸ¥è¯¢ç›®æ ‡åŸå¸‚/åŒºåŸŸçš„å¤©æ°”é¢„æŠ¥çŠ¶å†µã€‚
 * @param {Number | String} adcode åŸå¸‚åç§°ã€åŒºåŸŸç¼–ç ï¼ˆå¦‚ã€ä¸Šæµ·å¸‚ã€ã€ã€310000ã€ï¼‰ï¼Œé»˜è®¤ä¸Šæµ·
 * @see https://lbs.amap.com/api/jsapi-v2/guide/services/weather
 * @see https://lbs.amap.com/api/webservice/download
 * @returns è¿”å›ä¸€ä¸ªPromise
 */
export async function getWeather (adcode = 310000) {
  // å¦‚æœæ²¡æœ‰å®ä¾‹çš„è¯é‚£ä¹ˆåˆå§‹åŒ–ä¸€ä¸‹
  if (!AMap) {
    await _initWeather()
  }

  return new Promise((resolve, reject) => {
    if (!weather) {
      weather = new AMap.Weather()
    }
    weather.getLive(adcode, (err, data) => {
      if (!err) {
        // ç»„è£…æ–°çš„å¤©æ°”ç»“æœå¯¹è±¡ï¼Œé™¤äº†é«˜å¾·åœ°å›¾å¤©æ°”è‡ªå¸¦çš„å±æ€§ï¼Œè¿™é‡Œé¢è¿˜åŒ…å«äº†å›¾æ ‡çš„åœ°å€å±æ€§ï¼šurl
        const weatherData = Object.assign({}, data, { url: _getIcon(data.weather) })
        resolve(weatherData)
      } else {
        console.error('è·å–å¤©æ°”å¤±è´¥ = ', err)
        reject(err)
      }
    })
  })
}

```

## ä¾‹å­

```vue
import { getWeather } from '@/utils/weather.js'

// è·å–ä¸Šæµ·å¤©æ°”
getWeatherData () {
    getWeather('ä¸Šæµ·').then(data => {
        this.weatherData = data
		// dataä¸­å°±åŒ…å«äº†å½“å‰å¤©æ°”å›¾æ ‡
        console.debug('@å¤©æ°” = ', data, ' å›¾æ ‡ = ', data.url)
    })
}

```

